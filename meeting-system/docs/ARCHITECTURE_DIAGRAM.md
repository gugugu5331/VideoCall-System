# 🏗️ 系统架构图

## 整体拓扑（当前仓库）

```
╔══════════════════════════════════════════════════════════╗
║                       客户端层                           ║
╠══════════════════════════════════════════════════════════╣
║ Web 浏览器 (frontend/dist，经 Nginx 提供，同源 API)        ║
╚══════════════════════════════════════════════════════════╝
                              │ HTTP / WebSocket / WebRTC
╔══════════════════════════════════════════════════════════╗
║                        网关层                            ║
╠══════════════════════════════════════════════════════════╣
║ Nginx 反向代理 + 静态资源 (8800/443)                     ║
╚══════════════════════════════════════════════════════════╝
                              │ 反向代理
╔══════════════════════════════════════════════════════════╗
║                    微服务层 (Go + Gin)                   ║
╠════════════╦════════════╦════════════╦══════════════════╣
║ user-svc   ║ meeting-svc║ signaling  ║ media-svc        ║
║ 8080       ║ 8082       ║ 8081 WS    ║ 8083             ║
║ 认证/用户  ║ 会议/参会者 ║ 信令/房间   ║ 媒体/录制/上传    ║
╠════════════╩════════════╩════════════╩══════════════════╣
║ ai-inference-service (8085 HTTP → Triton 8000)          ║
╚══════════════════════════════════════════════════════════╝
                              │
╔══════════════════════════════════════════════════════════╗
║                     AI 推理层 (GPU)                      ║
╠══════════════════════════════════════════════════════════╣
║ Triton Inference Server (HTTP 8000) + 模型仓库           ║
╚══════════════════════════════════════════════════════════╝
                              │
╔══════════════════════════════════════════════════════════╗
║                        数据层                            ║
╠══════════╦════════╦══════════╦════════╦══════════════════╣
║ Postgres ║ Redis  ║ MongoDB  ║ MinIO  ║ etcd             ║
║ 结构化   ║ 缓存/队列║ AI 结果  ║ 对象存储║ 服务注册/配置    ║
╚══════════╩════════╩══════════╩════════╩══════════════════╝
                              │
╔══════════════════════════════════════════════════════════╗
║                    可观测性/运维                         ║
╠══════════════════════════════════════════════════════════╣
║ Prometheus 8801 | Alertmanager 8802 | Jaeger 8803        ║
║ Grafana 8804    | Loki/Promtail 8805                     ║
╚══════════════════════════════════════════════════════════╝
```

## 关键说明

- **前端**：当前仓库仅包含 Web 客户端构建产物（`frontend/dist`），默认同源访问 Nginx。
- **信令**：WebSocket `/ws/signaling`，使用 Redis 维护会话/房间状态。
- **媒体**：SFU 配套接口，录制/媒体文件元数据落库，实际文件存储 MinIO。
- **AI**：Go 服务暴露 `/api/v1/ai/*`，内部请求 Triton（GPU）；可通过 Nginx upstream 扩展到多节点。
- **配置**：端口/依赖以 `docker-compose.yml` 为准；敏感配置通过环境变量覆盖（JWT、CORS、证书）。

## 数据与调用流

1. 浏览器访问 `https://host:443` 或 `http://host:8800`，静态前端同源调用 API。
2. HTTP API 进入 Nginx，转发到各微服务；WebSocket 进入 `signaling-service`。
3. 媒体信令协商后，客户端通过 WebRTC 直接交换媒体；录制/元数据由 `media-service` 处理并写入 Postgres/MinIO。
4. AI 请求走 `/api/v1/ai/*` → `ai-inference-service` → Triton → 返回结果。
5. 指标/日志经 Prometheus + Loki 收集，Jaeger 提供链路追踪。

## 相关文档

- 架构细节：`BACKEND_ARCHITECTURE.md`
- 部署与端口：`../docker-compose.yml`、`DEPLOYMENT/README.md`
- API 列表：`API/API_DOCUMENTATION.md`
