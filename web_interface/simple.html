<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端测试 - 智能视频通话系统</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background-color: #d1fae5;
            border-left-color: #10b981;
            color: #065f46;
        }
        .error {
            background-color: #fee2e2;
            border-left-color: #ef4444;
            color: #991b1b;
        }
        .warning {
            background-color: #fef3c7;
            border-left-color: #f59e0b;
            color: #92400e;
        }
        .info {
            background-color: #dbeafe;
            border-left-color: #2563eb;
            color: #1e40af;
        }
        button {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1d4ed8;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>智能视频通话系统 - 前端测试</h1>
        
        <div id="status-container">
            <div class="status info">
                <strong>正在检查系统状态...</strong>
            </div>
        </div>

        <div class="test-section">
            <h3>快速测试</h3>
            <button onclick="testBasicFunctions()">测试基础功能</button>
            <button onclick="testAPI()">测试API连接</button>
            <button onclick="testMedia()">测试媒体设备</button>
            <button onclick="openMainApp()">打开主应用</button>
        </div>

        <div class="test-section">
            <h3>服务状态</h3>
            <div id="service-status"></div>
        </div>

        <div class="test-section">
            <h3>浏览器信息</h3>
            <div id="browser-info"></div>
        </div>
    </div>

    <script>
        // 页面加载时自动检查
        window.addEventListener('load', function() {
            checkSystemStatus();
        });

        function checkSystemStatus() {
            const statusContainer = document.getElementById('status-container');
            const serviceStatus = document.getElementById('service-status');
            const browserInfo = document.getElementById('browser-info');

            // 检查浏览器兼容性
            const browserTests = {
                'ES6支持': (() => {
                    try {
                        new Function('(a = 0) => a');
                        return true;
                    } catch (e) {
                        return false;
                    }
                })(),
                'WebRTC支持': 'RTCPeerConnection' in window,
                'WebSocket支持': 'WebSocket' in window,
                'LocalStorage支持': (() => {
                    try {
                        localStorage.setItem('test', 'test');
                        localStorage.removeItem('test');
                        return true;
                    } catch (e) {
                        return false;
                    }
                })(),
                'Fetch API支持': 'fetch' in window,
                'getUserMedia支持': !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)
            };

            // 显示浏览器信息
            let browserHtml = '';
            for (const [test, supported] of Object.entries(browserTests)) {
                const className = supported ? 'success' : 'error';
                const status = supported ? '✓ 支持' : '✗ 不支持';
                browserHtml += `<div class="status ${className}">${test}: ${status}</div>`;
            }
            browserInfo.innerHTML = browserHtml;

            // 检查所有测试是否通过
            const allSupported = Object.values(browserTests).every(Boolean);
            
            if (allSupported) {
                statusContainer.innerHTML = `
                    <div class="status success">
                        <strong>✓ 浏览器兼容性检查通过</strong><br>
                        您的浏览器支持所有必需的功能，可以正常使用视频通话系统。
                    </div>
                `;
            } else {
                statusContainer.innerHTML = `
                    <div class="status warning">
                        <strong>⚠ 浏览器兼容性警告</strong><br>
                        您的浏览器可能不支持某些功能，建议使用最新版本的Chrome、Firefox或Safari。
                    </div>
                `;
            }

            // 检查服务状态
            checkServiceStatus();
        }

        async function checkServiceStatus() {
            const serviceStatus = document.getElementById('service-status');
            
            // 检查后端服务
            try {
                const backendResponse = await fetch('http://localhost:8080/health', {
                    method: 'GET',
                    mode: 'cors',
                    timeout: 3000
                });
                
                if (backendResponse.ok) {
                    serviceStatus.innerHTML += `
                        <div class="status success">
                            <strong>后端服务</strong>: ✓ 运行正常 (端口 8080)
                        </div>
                    `;
                } else {
                    serviceStatus.innerHTML += `
                        <div class="status error">
                            <strong>后端服务</strong>: ✗ 响应异常 (端口 8080)
                        </div>
                    `;
                }
            } catch (error) {
                serviceStatus.innerHTML += `
                    <div class="status error">
                        <strong>后端服务</strong>: ✗ 连接失败 (端口 8080)<br>
                        错误: ${error.message}
                    </div>
                `;
            }

            // 检查AI服务
            try {
                const aiResponse = await fetch('http://localhost:8000/health', {
                    method: 'GET',
                    mode: 'cors',
                    timeout: 3000
                });
                
                if (aiResponse.ok) {
                    serviceStatus.innerHTML += `
                        <div class="status success">
                            <strong>AI服务</strong>: ✓ 运行正常 (端口 8000)
                        </div>
                    `;
                } else {
                    serviceStatus.innerHTML += `
                        <div class="status error">
                            <strong>AI服务</strong>: ✗ 响应异常 (端口 8000)
                        </div>
                    `;
                }
            } catch (error) {
                serviceStatus.innerHTML += `
                    <div class="status error">
                        <strong>AI服务</strong>: ✗ 连接失败 (端口 8000)<br>
                        错误: ${error.message}
                    </div>
                `;
            }
        }

        function testBasicFunctions() {
            alert('基础功能测试：\n✓ 页面加载正常\n✓ JavaScript运行正常\n✓ 事件处理正常');
        }

        async function testAPI() {
            try {
                const response = await fetch('http://localhost:8080/health');
                if (response.ok) {
                    alert('API连接测试：✓ 成功');
                } else {
                    alert('API连接测试：✗ 失败');
                }
            } catch (error) {
                alert('API连接测试：✗ 失败\n错误: ' + error.message);
            }
        }

        async function testMedia() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('媒体设备测试：✗ 浏览器不支持getUserMedia API');
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                const videoTracks = stream.getVideoTracks();
                const audioTracks = stream.getAudioTracks();
                
                stream.getTracks().forEach(track => track.stop());
                
                alert(`媒体设备测试：✓ 成功\n摄像头: ${videoTracks.length > 0 ? '可用' : '不可用'}\n麦克风: ${audioTracks.length > 0 ? '可用' : '不可用'}`);
            } catch (error) {
                alert('媒体设备测试：✗ 失败\n错误: ' + error.message);
            }
        }

        function openMainApp() {
            window.open('index.html', '_blank');
        }
    </script>
</body>
</html> 